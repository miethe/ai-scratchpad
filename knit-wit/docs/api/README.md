# Knit-Wit API Documentation

This directory contains comprehensive API documentation for the Knit-Wit backend REST API.

## Files

### api-contract.md
**Main API documentation** (Read this first)

- Complete endpoint specifications
- Request/response schemas with examples
- Error handling and status codes
- Authentication approach
- Rate limiting strategy (future)
- Testing examples with curl, Python, TypeScript
- API versioning strategy
- Roadmap for future versions

**Best for**: Understanding what the API does, detailed specifications, testing locally

### openapi.yaml
**OpenAPI 3.0 specification** (Machine-readable)

- Valid OpenAPI 3.0.3 format
- Importable into Postman, Insomnia, SwaggerUI
- Autogenerated API documentation possible
- Code generation from spec
- Interactive API exploration

**Best for**: Tools integration, API client generation, interactive exploration

### quick-reference.md
**Developer cheat sheet** (Quick lookup)

- One-page quick reference
- Common curl examples
- Error codes quick lookup
- Endpoint summary table
- Performance targets

**Best for**: Quick lookup while coding, copy-paste examples

## Using This Documentation

### I want to...

#### Understand the overall API design
1. Read **api-contract.md** sections:
   - Overview
   - API Versioning
   - Error Handling
   - Endpoints (pick the one you need)

#### Test an endpoint locally
1. See **api-contract.md** "Testing & Examples" section
2. Copy the curl example for your endpoint
3. Run it against local server: `http://localhost:8000`

#### Import into Postman/Insomnia
1. Download or copy **openapi.yaml**
2. In Postman: File → Import → Paste as text
3. In Insomnia: Create new workspace → Import → From URL/File
4. All endpoints auto-populate with proper schemas

#### Generate API client
1. Use **openapi.yaml** with tools like:
   - OpenAPI Generator
   - Swagger Codegen
   - Client libraries (Python, TypeScript, etc.)

Example:
```bash
openapi-generator-cli generate \
  -i docs/api/openapi.yaml \
  -g typescript-axios \
  -o apps/mobile/src/api
```

#### Write frontend code
1. Reference **openapi.yaml** schemas
2. See endpoint examples in **api-contract.md**
3. Use generated TypeScript types if available
4. Check error responses for proper error handling

#### Debug an error
1. Find your error code in **api-contract.md** Error Handling section
2. Check error response example
3. See what details are provided
4. Implement proper error handling in client

## API Quick Facts

### Base URL
```
Development: http://localhost:8000/api/v1
Production: https://api.knit-wit.app/api/v1
```

### Current Version
- **v0.1.0** (MVP phase)
- Version included in all responses

### Authentication
- **MVP**: Not required
- **Future (v1.1)**: JWT tokens or OAuth 2.0

### Response Format
All responses follow this structure:
```json
{
  "success": true/false,
  "data": { /* endpoint-specific */ },
  "meta": {
    "version": "0.1.0",
    "timestamp": "2024-11-10T...",
    "request_id": "req_..."
  }
}
```

### Error Format
```json
{
  "success": false,
  "error": {
    "code": "ERROR_CODE",
    "message": "description",
    "details": { /* context */ }
  },
  "meta": { /* standard meta */ }
}
```

## Key Endpoints

| Method | Path | Purpose |
|--------|------|---------|
| POST | `/patterns/generate` | Generate pattern from parameters |
| GET | `/patterns/{id}` | Retrieve cached pattern |
| POST | `/patterns/{id}/export/pdf` | Export to PDF |
| POST | `/patterns/{id}/export/svg` | Export to SVG |
| GET | `/health` | Health check |

## Development Workflow

### Phase 1 Implementation
When implementing these endpoints, follow this order:

1. **POST /patterns/generate** - Core feature, highest priority
2. **GET /health** - Already exists, confirm compliance
3. **POST /patterns/{id}/export/pdf** - Major export feature
4. **POST /patterns/{id}/export/svg** - Quick export feature
5. **GET /patterns/{id}** - Optional retrieval (can defer)

### Integration Checklist

When implementing an endpoint:

- [ ] Create Pydantic request/response models
- [ ] Create API route handler
- [ ] Validate all inputs per spec
- [ ] Return correct status codes
- [ ] Use standardized error format
- [ ] Add request/response logging
- [ ] Write unit tests (80%+ coverage target)
- [ ] Update OpenAPI spec if changed
- [ ] Test with curl examples provided
- [ ] Verify error handling

## Testing the API

### Using curl
```bash
# Health check
curl http://localhost:8000/health

# Generate pattern
curl -X POST http://localhost:8000/api/v1/patterns/generate \
  -H "Content-Type: application/json" \
  -d '{"shape":{"shape_type":"sphere","diameter_cm":10.0},"gauge":{"stitches_per_cm":1.4,"rows_per_cm":1.6}}'

# Export to PDF
curl -X POST http://localhost:8000/api/v1/patterns/{pattern_id}/export/pdf
```

### Using Swagger UI
```bash
# Navigate to
http://localhost:8000/docs

# Try out any endpoint in the browser
```

### Using httpx (Python)
```python
import httpx

async with httpx.AsyncClient() as client:
    response = await client.post(
        "http://localhost:8000/api/v1/patterns/generate",
        json={
            "shape": {"shape_type": "sphere", "diameter_cm": 10.0},
            "gauge": {"stitches_per_cm": 1.4, "rows_per_cm": 1.6}
        }
    )
    print(response.json())
```

### Using axios (TypeScript)
```typescript
import axios from 'axios';

const response = await axios.post(
  'http://localhost:8000/api/v1/patterns/generate',
  {
    shape: { shape_type: 'sphere', diameter_cm: 10.0 },
    gauge: { stitches_per_cm: 1.4, rows_per_cm: 1.6 }
  }
);

console.log(response.data);
```

## Performance Targets

| Endpoint | Target P95 | Timeout |
|----------|-----------|---------|
| /patterns/generate | <200ms | 30s |
| /patterns/{id} | <50ms | 10s |
| /patterns/{id}/export/pdf | <2s | 30s |
| /patterns/{id}/export/svg | <500ms | 10s |
| /health | <50ms | 5s |

## Error Codes Reference

Quick lookup of error codes:

### 400 Bad Request
- `VALIDATION_ERROR` - Input validation failed
- `INVALID_GAUGE` - Gauge parameters invalid
- `INVALID_DIMENSIONS` - Shape dimensions invalid
- `INVALID_SHAPE` - Unsupported shape type
- `MISSING_REQUIRED_FIELD` - Required field missing

### 404 Not Found
- `PATTERN_NOT_FOUND` - Pattern doesn't exist or expired
- `EXPORT_NOT_FOUND` - Export not available

### 500 Internal Server Error
- `GENERATION_ERROR` - Pattern generation failed
- `EXPORT_ERROR` - Export generation failed
- `INTERNAL_ERROR` - Unexpected error

See **api-contract.md** Error Handling section for details.

## Future API Versions

### v1.1 (Planned)
- User authentication (JWT/OAuth)
- Pattern persistence (database)
- Pattern history and favorites
- Rate limiting per user
- Support for more stitch types (HDC, DC)
- Async exports for large patterns

### v2.0+ (Planned)
- Colorwork and stripes
- Custom shape definitions
- Community pattern sharing
- Yarn recommendation
- AR preview
- Subscription features

See **api-contract.md** "API Maturity & Roadmap" for complete roadmap.

## Support

### Questions About the API?

1. **Check Examples**: See api-contract.md Testing section
2. **Check Endpoints**: Find your endpoint in api-contract.md
3. **Check Errors**: Look up error code in Error Handling
4. **File Issue**: github.com/knit-wit/issues (placeholder)
5. **Contact Team**: dev@knit-wit.example.com (placeholder)

### Found a Bug?

1. Verify it matches api-contract.md specification
2. If spec issue: Update api-contract.md
3. If implementation issue: Create bug ticket
4. If OpenAPI issue: Update openapi.yaml

## Related Documentation

- **DSL Specification**: `/docs/dsl-specification.md` - Pattern data format
- **Algorithm Spike**: `/docs/architecture/algorithm-spike.md` - Math behind patterns
- **CLAUDE.md**: `/knit-wit/CLAUDE.md` - Project setup and guidelines
- **Implementation Plan**: `/project_plans/mvp/phases/phase-0.md` - Phase 0 tasks

---

**Last Updated**: 2024-11-10
**API Version**: 0.1.0 (MVP)
**Status**: Complete for Phase 0, Implementation Phase 1+
